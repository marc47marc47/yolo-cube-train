# 品質管理快速上手指南

5 分鐘快速建立生產線品質管理系統。

## 🚀 快速開始（3 步驟）

### 步驟 1：收集影像（按 0-9 鍵標記品質）

```bash
# 啟動攝影機截圖模式
python -m src.app --source 0 --show

# 操作說明：
# - 將產品放在攝影機前
# - 按 0-9 數字鍵快速截圖並標記品質
# - 按 'q' 退出

# 品質評分標準：
# 9 = 完美無瑕疵
# 7-8 = 輕微瑕疵（可接受）
# 4-6 = 中等缺陷（需檢查）
# 1-3 = 嚴重缺陷（不合格）
# 0 = 完全不合格
```

**建議收集數量**：
- 每個品質等級：50-100 張影像
- 總計：500-1000 張影像
- 時間：約 30-60 分鐘

### 步驟 2：分析資料分布

```bash
# 查看品質分布統計
python scripts/analyze_quality_data.py

# 輸出範例：
# ============================================================
# 品質標記資料分析報告
# ============================================================
#
# 總截圖數: 500
# 已標記: 500 張
#
# 品質分布:
# ------------------------------------------------------------
# 品質等級         數量       百分比          視覺化
# ------------------------------------------------------------
# Quality 0 (最差) 45         9.0%         ████
# Quality 1        42         8.4%         ████
# ...
# Quality 9 (滿分) 58         11.6%        █████
# ------------------------------------------------------------
#
# 平均品質: 5.23 / 9.0
```

### 步驟 3：準備訓練資料（可選）

如果想要訓練自訂模型，需要將品質標記轉換為缺陷類別標記。

```bash
# 方法 1：簡化分類（二分類）
# 將品質 0-5 標記為 "defect"（缺陷）
# 將品質 6-9 標記為 "good"（良品）

# 方法 2：多級分類
# Quality 9: good
# Quality 7-8: minor_defect
# Quality 4-6: major_defect
# Quality 0-3: reject

# 詳細步驟請參考 HOWTO.md
```

---

## 📊 實際應用範例

### 範例 1：快速品檢（即時偵測）

```bash
# 使用預訓練模型進行即時品檢
python -m src.app --source 0 --model yolov8n.pt --conf 0.5 --show

# 按數字鍵記錄品質：
# - 看到合格品 → 按 '9'
# - 看到缺陷品 → 按 '0-3'（依嚴重程度）
```

### 範例 2：生產線統計

收集 100 個產品樣本後：

```bash
python scripts/analyze_quality_data.py
```

可得到：
- 良品率（Quality 7-9）
- 缺陷率（Quality 0-6）
- 各品質等級分布
- 平均品質分數

### 範例 3：品質趨勢追蹤

按時間段收集資料：

```bash
# 早班（8:00-12:00）
python -m src.app --source 0 --show
# 收集 100 張，分析品質

# 午班（12:00-16:00）
python -m src.app --source 0 --show
# 收集 100 張，分析品質

# 晚班（16:00-20:00）
python -m src.app --source 0 --show
# 收集 100 張，分析品質

# 比較不同時段的品質差異
```

---

## 🎯 品質評分指南

### 電子零件檢測

| 評分 | 標準 | 範例 |
|------|------|------|
| 9 | 外觀完美，無任何瑕疵 | 表面光滑，無刮痕、無變色 |
| 7-8 | 輕微瑕疵，不影響功能 | 微小刮痕（< 1mm） |
| 4-6 | 明顯缺陷，需要檢查 | 刮痕、輕微凹陷 |
| 1-3 | 嚴重缺陷，不合格 | 裂痕、嚴重變形、缺件 |
| 0 | 完全損壞 | 破碎、無法使用 |

### PCB 電路板檢測

| 評分 | 標準 | 範例 |
|------|------|------|
| 9 | 完美，可直接出貨 | 無短路、無斷路、無毛刺 |
| 7-8 | 輕微瑕疵，可修復 | 輕微毛刺（< 0.5mm） |
| 4-6 | 需返工 | 明顯毛刺、小缺孔 |
| 1-3 | 嚴重缺陷 | 短路、斷路、多餘銅箔 |
| 0 | 報廢 | 大面積缺陷、無法修復 |

### 食品包裝檢測

| 評分 | 標準 | 範例 |
|------|------|------|
| 9 | 包裝完整，標籤清晰 | 封口完好、無污染 |
| 7-8 | 輕微問題 | 標籤稍微歪斜 |
| 4-6 | 明顯問題 | 封口不良、輕微污染 |
| 1-3 | 嚴重問題 | 破損、明顯污染 |
| 0 | 完全不合格 | 破裂、嚴重污染 |

---

## 💡 最佳實踐

### 1. 建立標準作業流程（SOP）

```markdown
# 品質檢測 SOP

1. 環境準備
   - 確認光線充足且均勻
   - 清潔攝影機鏡頭
   - 調整攝影機角度

2. 標記前校準
   - 檢查 3-5 個已知品質的樣本
   - 確認評分標準一致性

3. 執行標記
   - 每 50 張檢查一次分布
   - 確保各品質等級均衡
   - 記錄異常情況

4. 品質控制
   - 每日分析品質趨勢
   - 與前一天數據比較
   - 及時調整生產參數
```

### 2. 團隊協作

多人標記時，確保標準一致：

```bash
# 標記人員 A
python -m src.app --source 0 --show
# 標記 200 張

# 標記人員 B
python -m src.app --source 0 --show
# 標記 200 張

# 交叉驗證：隨機抽取 20 張，兩人重新評分
# 一致性 > 85% 為可接受
```

### 3. 資料備份

```bash
# 每天備份收集的資料
cp -r artifacts/screenshots artifacts/screenshots_backup_$(date +%Y%m%d)

# 或使用 Git
cd artifacts/screenshots
git add .
git commit -m "Daily QC data: $(date +%Y-%m-%d)"
```

---

## 📈 進階功能

### 自動品質報告

創建每日品質報告：

```bash
# 生成 HTML 報告（需自行開發）
python scripts/generate_qc_report.py --date today --output reports/qc_report.html
```

### 匯出統計資料

```bash
# 匯出為 CSV
python scripts/analyze_quality_data.py --export --output quality_data.csv

# 可用 Excel 或其他工具進一步分析
```

### 設定品質閾值告警

```bash
# 如果缺陷率 > 20%，自動告警（需自行開發）
python scripts/quality_alert.py --threshold 0.2 --notify email
```

---

## 🔧 疑難排解

### Q1: 按數字鍵沒反應？

**解決**：
- 確保視窗是啟動狀態（點擊視窗）
- 使用主鍵盤的數字鍵（非小鍵盤）
- 檢查終端機是否有錯誤訊息

### Q2: 截圖儲存在哪裡？

**位置**：
```
artifacts/screenshots/
├── quality_0/  (品質評分 0)
├── quality_1/  (品質評分 1)
├── ...
├── quality_9/  (品質評分 9)
└── unlabeled/  (按 's' 鍵的截圖)
```

### Q3: 如何刪除錯誤的截圖？

```bash
# 刪除特定品質等級的所有截圖
rm -rf artifacts/screenshots/quality_5

# 刪除單張截圖
rm artifacts/screenshots/quality_3/q3_20250116_143052_123.jpg

# 重新開始（清空所有）
rm -rf artifacts/screenshots/*
```

### Q4: 品質分布不平衡怎麼辦？

```bash
# 1. 查看當前分布
python scripts/analyze_quality_data.py

# 2. 針對性收集不足的品質等級
# 例如：如果 quality_3 只有 10 張，繼續收集此等級

python -m src.app --source 0 --show
# 專門收集品質 3 的樣本，按 '3' 鍵

# 3. 重新檢查分布
python scripts/analyze_quality_data.py
```

---

## 📚 相關文件

- [README.md](README.md) - 專案總覽與安裝說明
- [HOWTO.md](HOWTO.md) - 完整訓練流程指南
- [DEVELOP.md](DEVELOP.md) - 開發文件

---

## 🎓 學習資源

### 推薦閱讀順序

1. **第 1 天**：快速收集 100-200 張資料
   - 閱讀本文件
   - 執行資料收集
   - 分析品質分布

2. **第 2-3 天**：擴充資料集至 500-1000 張
   - 確保各品質等級平衡
   - 包含不同時段、光線的樣本

3. **第 4-5 天**：學習模型訓練（如需要）
   - 閱讀 [HOWTO.md](HOWTO.md)
   - 準備 YOLO 格式標記
   - 訓練自訂模型

### 實際案例

```bash
# 案例：電子工廠品質檢測
# 目標：每日生產 1000 個零件，自動記錄品質

# Day 1: 收集基線資料
python -m src.app --source 0 --show
# 收集 500 張 → 分析品質分布

# Day 2-7: 持續監控
# 每日收集 100 張樣本
# 分析品質趨勢
# 對比週一到週五的差異

# Day 8: 生成報告
python scripts/analyze_quality_data.py --export
# 週報告：平均品質、缺陷率、改善建議
```

---

## ✅ 檢查清單

開始品質管理前的檢查：

- [ ] Python 環境已安裝（Python 3.10+）
- [ ] 依賴套件已安裝（`pip install -r requirements.txt`）
- [ ] 攝影機可正常使用
- [ ] 光線充足且均勻
- [ ] 已建立評分標準
- [ ] 準備不同品質的樣本
- [ ] 已創建備份計畫

開始收集資料：

- [ ] 執行 `python -m src.app --source 0 --show`
- [ ] 測試按數字鍵截圖功能
- [ ] 確認截圖儲存位置
- [ ] 收集至少 50 張各品質等級
- [ ] 執行 `python scripts/analyze_quality_data.py`
- [ ] 檢查品質分布是否平衡

---

**開始使用**：

```bash
# 立即開始
python -m src.app --source 0 --show

# 開始標記品質，按 0-9 鍵！
```
